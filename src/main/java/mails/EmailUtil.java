package mails;

import javax.mail.*;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeBodyPart;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMultipart;
import java.io.File;

/**
 * The type Email util.
 */
public class EmailUtil {

    /**
     * Send email with reports.
     *
     * @param session     the session
     * @param fromEmail   the from email
     * @param toEmail     the to email
     * @param subjectName the subject name
     */
    public static void sendEmailWithReports(Session session, String fromEmail, String toEmail, String subjectName){
        try{
            Message message = new MimeMessage(session);
            message.setFrom(new InternetAddress(fromEmail));
            message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(toEmail));
            message.setSubject(subjectName + " reports");

            BodyPart messageBodyPart = new MimeBodyPart();
            messageBodyPart.setText("These are the reports generated by Grades manager App for " + subjectName);

            MimeBodyPart txtAttachment = new MimeBodyPart();
            txtAttachment.attachFile(new File("reports/" + subjectName + ".txt"));
            MimeBodyPart pdfAttachment = new MimeBodyPart();
            pdfAttachment.attachFile(new File("reports/" + subjectName + ".pdf"));

            Multipart multipart = new MimeMultipart();
            multipart.addBodyPart(messageBodyPart);
            multipart.addBodyPart(txtAttachment);
            multipart.addBodyPart(pdfAttachment);
            message.setContent(multipart);
            Transport.send(message);
            System.out.println("Email sent successfully!");
        }catch (Exception e){
            System.out.println("An error has occurred, couldn't send the message.");
        }
    }
}
